<!DOCTYPE html>
<html>


<head>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
</head>

<body>

<div id="myChart" style="width: 480px; height: 400px;"><!-- Plotly chart will be drawn inside this DIV --></div>
<script>

    function makeplot() {
      Plotly.d3.csv("http://localhost:8080/stockdata/", function(data){ processData(data, true) } );
    };

    var layout = {
      yaxis: {range: [0, 10000]},
      title: 'Plotting data from Kudu!!!'
    };

    function processData(allRows, firstRun) {
      var plotCreated = false;
      var x = [], y = [], currentSymbol = '';
      for (var i=0; i<allRows.length; i++) {
        row = allRows[i];
        if(row['symbol'] != currentSymbol) {
            if(currentSymbol != '') {
                var traces = [{
                    x: x,
                    y: y,
                    name: currentSymbol
                  }];
                if(!plotCreated && firstRun) {
                    Plotly.newPlot('myChart', traces, layout);
                    plotCreated=true;
                } else {
                    if(firstRun) {
                        Plotly.addTraces('myChart', traces);
                    } else {
                        Plotly.restyle('myChart', traces);
                    }
                }
            }
            currentSymbol = row['symbol'];
            x = [];
            y = [];
        }
        x.push( row['timestamp'] );
        y.push( row['orderqty'] );
      }
    };

    makeplot();

    window.setInterval(function(){
        Plotly.d3.csv("http://localhost:8080/stockdata/", function(data){ processData(data, false) } );
    }, 5000);

  </script>
</body>
</html>